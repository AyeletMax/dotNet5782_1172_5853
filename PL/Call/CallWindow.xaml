<Window x:Class="PL.Call.CallWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:PL.Converters"
        Title="Call Details" Height="700" Width="800"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize"
        DataContext="{Binding RelativeSource={RelativeSource Self}}">

    <Window.Resources>
        <converters:ConvertIdToVisibility x:Key="ConvertIdToVisibility"/>
        <converters:ConvertIdToReadOnly x:Key="ConvertIdToReadOnly"/>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </Window.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="20" Background="#F8F9FA">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Title -->
            <Border Grid.Row="0" Background="#007ACC" CornerRadius="5" Margin="0,0,0,20">
                <TextBlock FontSize="24" 
                          FontWeight="Bold" 
                          Foreground="White"
                          HorizontalAlignment="Center" 
                          Padding="10">
                    <TextBlock.Text>
                        <MultiBinding StringFormat="{}Call Details - ID: {0}">
                            <Binding Path="Call.Id"/>
                        </MultiBinding>
                    </TextBlock.Text>
                </TextBlock>
            </Border>

            <!-- Call ID (only in edit mode) -->
            <!--<StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,10"
                       Visibility="{Binding Call.Id, Converter={StaticResource ConvertIdToVisibility}}">
                <TextBlock Text="Call ID:" 
                          Width="150" 
                          FontWeight="SemiBold" 
                          VerticalAlignment="Center"
                          FontSize="14"/>
                <TextBox Width="300" 
                        Height="30"
                        FontSize="14"
                        Text="{Binding Call.Id}"
                        IsReadOnly="True"
                        Background="#F0F0F0"
                        BorderBrush="#CCCCCC"
                        BorderThickness="1"
                        Padding="5"/>
            </StackPanel>-->

            <!-- Call Type -->
            <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,10">
                <TextBlock Text="Call Type:" 
                          Width="150" 
                          FontWeight="SemiBold" 
                          VerticalAlignment="Center"
                          FontSize="14"/>
                <ComboBox Name="CallTypeComboBox"
                         Width="300" 
                         Height="30"
                         FontSize="14"
                         SelectedValue="{Binding Call.MyCallType}"
                         SelectionChanged="CallTypeComboBox_SelectionChanged"
                         IsEnabled="{Binding CanEditAllFields}">
                    <ComboBoxItem Content="Music Performance" Tag="MusicPerformance"/>
                    <ComboBoxItem Content="Music Therapy" Tag="MusicTherapy"/>
                    <ComboBoxItem Content="Singing and Emotional Support" Tag="SingingAndEmotionalSupport"/>
                    <ComboBoxItem Content="Group Activities" Tag="GroupActivities"/>
                    <ComboBoxItem Content="Personalized Music Care" Tag="PersonalizedMusicCare"/>
                </ComboBox>
            </StackPanel>

            <!-- Address -->
            <StackPanel Grid.Row="3" Orientation="Horizontal" Margin="0,10">
                <TextBlock Text="Address:" 
                          Width="150" 
                          FontWeight="SemiBold" 
                          VerticalAlignment="Center"
                          FontSize="14"/>
                <TextBox Name="AddressTextBox"
                        Width="300" 
                        Height="30"
                        FontSize="14"
                        Text="{Binding Call.Address, UpdateSourceTrigger=PropertyChanged}"
                        BorderBrush="#CCCCCC"
                        BorderThickness="1"
                        Padding="5"
                        IsReadOnly="{Binding CanEditAllFields, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            </StackPanel>

            <!-- Verbal Description -->
            <StackPanel Grid.Row="4" Orientation="Horizontal" Margin="0,10" VerticalAlignment="Top">
                <TextBlock Text="Verbal Description:" 
                          Width="150" 
                          FontWeight="SemiBold" 
                          VerticalAlignment="Top"
                          FontSize="14"
                          Margin="0,5,0,0"/>
                <TextBox Name="DescriptionTextBox"
                        Width="300" 
                        Height="80"
                        FontSize="14"
                        Text="{Binding Call.VerbalDescription, UpdateSourceTrigger=PropertyChanged}"
                        BorderBrush="#CCCCCC"
                        BorderThickness="1"
                        Padding="5"
                        TextWrapping="Wrap"
                        AcceptsReturn="True"
                        VerticalScrollBarVisibility="Auto"
                        MaxLength="500"
                        IsReadOnly="{Binding CanEditAllFields, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            </StackPanel>

            <!-- Maximum Finish Time -->
            <StackPanel Grid.Row="5" Orientation="Horizontal" Margin="0,10">
                <TextBlock Text="Maximum Finish Time:" 
                          Width="150" 
                          FontWeight="SemiBold" 
                          VerticalAlignment="Center"
                          FontSize="14"/>
                <DatePicker Name="MaxFinishDatePicker"
                           Width="140"
                           Height="30"
                           FontSize="14"
                           SelectedDate="{Binding MaxFinishDate}"
                           BorderBrush="#CCCCCC"
                           BorderThickness="1"/>
                <TextBox Name="MaxFinishTimeTextBox"
                        Width="100"
                        Height="30"
                        FontSize="14"
                        Text="{Binding MaxFinishTime, UpdateSourceTrigger=PropertyChanged}"
                        BorderBrush="#CCCCCC"
                        BorderThickness="1"
                        Padding="5"
                        Margin="10,0,0,0"
                        ToolTip="Format: HH:MM"/>
                <TextBlock Text="(hour:minute)" 
                          VerticalAlignment="Center"
                          FontSize="12"
                          Foreground="Gray"
                          Margin="5,0,0,0"/>
            </StackPanel>

            <!-- Status (read-only) -->
            <StackPanel Grid.Row="6" Orientation="Horizontal" Margin="0,10">
                <TextBlock Text="Call Status:" 
                          Width="150" 
                          FontWeight="SemiBold" 
                          VerticalAlignment="Center"
                          FontSize="14"/>
                <TextBox Width="300" 
                        Height="30"
                        FontSize="14"
                        Text="{Binding Call.MyStatus}"
                        IsReadOnly="True"
                        Background="#F0F0F0"
                        BorderBrush="#CCCCCC"
                        BorderThickness="1"
                        Padding="5"/>
            </StackPanel>

            <!-- Open Time (read-only) -->
            <StackPanel Grid.Row="7" Orientation="Horizontal" Margin="0,10">
                <TextBlock Text="Open Time:" 
                          Width="150" 
                          FontWeight="SemiBold" 
                          VerticalAlignment="Center"
                          FontSize="14"/>
                <TextBox Width="300" 
                        Height="30"
                        FontSize="14"
                        Text="{Binding Call.OpenTime, StringFormat='dd/MM/yyyy HH:mm:ss'}"
                        IsReadOnly="True"
                        Background="#F0F0F0"
                        BorderBrush="#CCCCCC"
                        BorderThickness="1"
                        Padding="5"/>
            </StackPanel>

            <!-- Assignments Section -->
            <GroupBox Name="AssignmentsSection" Grid.Row="8" Header="Call Assignments" 
                     Margin="0,20,0,10" Padding="10"
                     Visibility="{Binding HasAssignments, Converter={StaticResource BooleanToVisibilityConverter}}"
                     FontWeight="SemiBold" FontSize="14">
                <DataGrid ItemsSource="{Binding Call.CallAssignments}"
                         AutoGenerateColumns="False"
                         IsReadOnly="True"
                         HeadersVisibility="Column"
                         GridLinesVisibility="Horizontal"
                         AlternatingRowBackground="#F5F5F5"
                         RowHeight="30"
                         FontSize="12"
                         MaxHeight="200">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Volunteer ID" Binding="{Binding VolunteerId}" Width="100"/>
                        <DataGridTextColumn Header="Volunteer Name" Binding="{Binding Name}" Width="150"/>
                        <DataGridTextColumn Header="Start Time" Binding="{Binding EntranceTime, StringFormat='dd/MM/yyyy HH:mm'}" Width="120"/>
                        <DataGridTextColumn Header="End Time" Binding="{Binding ExitTime, StringFormat='dd/MM/yyyy HH:mm'}" Width="120"/>
                        <DataGridTextColumn Header="Finish Type" Binding="{Binding FinishCallType}" Width="120"/>
                    </DataGrid.Columns>
                </DataGrid>
            </GroupBox>

            <!-- Edit Permission Info -->
            <TextBlock Grid.Row="9" 
                      FontSize="12" 
                      Foreground="Blue" 
                      HorizontalAlignment="Center" 
                      Margin="0,10"
                      TextWrapping="Wrap">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding CanEditAllFields}" Value="True">
                                <Setter Property="Text" Value="All fields can be edited"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding CanEditOnlyMaxTime}" Value="True">
                                <Setter Property="Text" Value="Only maximum finish time can be edited"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding CannotEdit}" Value="True">
                                <Setter Property="Text" Value="Call is closed/expired - no editing allowed"/>
                                <Setter Property="Foreground" Value="Red"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>

            <!-- Error Message -->
            <TextBlock Name="ErrorMessageTextBlock"
                      Grid.Row="10"
                      Text=""
                      Foreground="Red"
                      FontWeight="SemiBold"
                      HorizontalAlignment="Center"
                      Margin="0,10"
                      TextWrapping="Wrap"
                      Visibility="Collapsed"/>

            <!-- Buttons -->
            <StackPanel Grid.Row="12" 
                       Orientation="Horizontal" 
                       HorizontalAlignment="Center" 
                       Margin="0,20,0,0">
                <Button Name="AddButton"
                       Content="Add Call" 
                       Width="120" 
                       Height="40"
                       FontSize="16"
                       FontWeight="SemiBold"
                       Background="#28A745"
                       Foreground="White"
                       BorderThickness="0"
                       Margin="0,0,20,0"
                       Cursor="Hand"
                       Click="AddButton_Click"
                       IsEnabled="{Binding CannotEdit, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" 
                                               CornerRadius="5"
                                               BorderThickness="{TemplateBinding BorderThickness}"
                                               BorderBrush="{TemplateBinding BorderBrush}">
                                            <ContentPresenter HorizontalAlignment="Center" 
                                                            VerticalAlignment="Center"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#218838"/>
                                            </Trigger>
                                            <Trigger Property="IsEnabled" Value="False">
                                                <Setter Property="Background" Value="#6C757D"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                </Button>

                <Button Name="CancelButton"
                       Content="Cancel" 
                       Width="120" 
                       Height="40"
                       FontSize="16"
                       FontWeight="SemiBold"
                       Background="#6C757D"
                       Foreground="White"
                       BorderThickness="0"
                       Cursor="Hand"
                       Click="CancelButton_Click">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" 
                                               CornerRadius="5"
                                               BorderThickness="{TemplateBinding BorderThickness}"
                                               BorderBrush="{TemplateBinding BorderBrush}">
                                            <ContentPresenter HorizontalAlignment="Center" 
                                                            VerticalAlignment="Center"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#5A6268"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                </Button>
            </StackPanel>
        </Grid>
    </ScrollViewer>
</Window>