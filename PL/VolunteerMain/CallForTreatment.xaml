<!--<Window x:Class="VolunteerSystem.CallForTreatment"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:VolunteerSystem"
        WindowStartupLocation="CenterScreen"
        FlowDirection="RightToLeft"
        Title="Choose Opened Calls" Height="800" Width="1200">
    <Window.Resources>
        <Style x:Key="HeaderTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#2C3E50"/>
            <Setter Property="Margin" Value="5"/>
        </Style>

        <Style x:Key="ButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#3498DB"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#2980B9"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="SelectButtonStyle" TargetType="Button" BasedOn="{StaticResource ButtonStyle}">
            <Setter Property="Background" Value="#27AE60"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#229954"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="FilterComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Padding" Value="5"/>
            <Setter Property="MinWidth" Value="120"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="300"/>
        </Grid.RowDefinitions>


        <TextBlock Grid.Row="0" Text="Opened Calls" 
                   FontSize="24" FontWeight="Bold" 
                   HorizontalAlignment="Center" 
                   Margin="10" Foreground="#2C3E50"/>

        <Border Grid.Row="1" Background="#ECF0F1" Padding="10" Margin="5">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <TextBlock Text="Filter By Call Type:" Style="{StaticResource HeaderTextStyle}" VerticalAlignment="Center"/>
                <ComboBox x:Name="CallTypeFilterComboBox" Style="{StaticResource FilterComboBoxStyle}"
                                      SelectionChanged="CallTypeFilter_SelectionChanged"/>

                <TextBlock Text="Sort By:" Style="{StaticResource HeaderTextStyle}" VerticalAlignment="Center" Margin="20,5,5,5"/>
                <ComboBox x:Name="SortFieldComboBox" Style="{StaticResource FilterComboBoxStyle}"
                          SelectionChanged="SortField_SelectionChanged"/>

                <Button x:Name="RefreshButton" Content="Refresh List" Style="{StaticResource ButtonStyle}"
                        Click="RefreshButton_Click" Margin="20,5,5,5"/>

                <Button x:Name="UpdateAddressButton" Content="Update Adresses" Style="{StaticResource ButtonStyle}"
                        Click="UpdateAddressButton_Click"/>
            </StackPanel>
        </Border>

        <DataGrid x:Name="OpenCallsDataGrid" Grid.Row="2" 
                  AutoGenerateColumns="False" 
                  SelectionMode="Single"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  CanUserResizeRows="False"
                  GridLinesVisibility="Horizontal"
                  HeadersVisibility="Column"
                  SelectionChanged="OpenCallsDataGrid_SelectionChanged"
                  Margin="10">

            <DataGrid.Columns>
                <DataGridTextColumn Header="Call Number" Binding="{Binding Id}" Width="80" IsReadOnly="True"/>
                <DataGridTextColumn Header="Call Type" Binding="{Binding MyCallType}" Width="100" IsReadOnly="True"/>
                <DataGridTextColumn Header="Address" Binding="{Binding Address}" Width="200" IsReadOnly="True"/>
                <DataGridTextColumn Header="Opening Time" Binding="{Binding OpenTime, StringFormat='dd/MM/yyyy HH:mm'}" Width="120" IsReadOnly="True"/>
                <DataGridTextColumn Header="Max Finish Time" Binding="{Binding MaxFinishTime, StringFormat='dd/MM/yyyy HH:mm'}" Width="130" IsReadOnly="True"/>
                <DataGridTextColumn Header="Distance (KM)" Binding="{Binding distanceFromVolunteerToCall, StringFormat=F2}" Width="80" IsReadOnly="True"/>

                <DataGridTemplateColumn Header="Action" Width="100">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Content=" Choose For Treatment" 
                                    Style="{StaticResource SelectButtonStyle}"
                                    Click="SelectCallButton_Click"
                                    Tag="{Binding Id}"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <Grid Grid.Row="3">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" Background="#F8F9FA" BorderBrush="#DEE2E6" BorderThickness="1" Margin="10">
                <StackPanel Margin="10">
                    <TextBlock Text=" Selected Call Details " Style="{StaticResource HeaderTextStyle}" HorizontalAlignment="Center"/>
                    <Separator Margin="0,5"/>
                    <ScrollViewer MaxHeight="200" VerticalScrollBarVisibility="Auto">
                        <TextBlock x:Name="CallDescriptionTextBlock" 
                                   TextWrapping="Wrap" 
                                   Text="Select a call from the list to see the details."
                                   FontSize="12"
                                   Margin="5"/>
                    </ScrollViewer>
                </StackPanel>
            </Border>

            <Border Grid.Column="1" Background="White" BorderBrush="#DEE2E6" BorderThickness="1" Margin="10">
                <Grid>
                    <TextBlock x:Name="MapPlaceholder" 
                               Text=""
                               HorizontalAlignment="Center" 
                               VerticalAlignment="Center"
                               FontSize="14" 
                               Foreground="Gray"
                               TextAlignment="Center"/>

                    <WebBrowser x:Name="MapWebBrowser" Visibility="Collapsed"/>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Window>--><!--
<Window x:Class="VolunteerSystem.CallForTreatment"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:VolunteerSystem.ViewModels"
        xmlns:myConverters="clr-namespace:PL.Converters"
        xmlns:m="clr-namespace:Microsoft.Maps.MapControl.WPF;assembly=Microsoft.Maps.MapControl.WPF"
        WindowStartupLocation="CenterScreen"
        FlowDirection="RightToLeft"
        Title="Choose Opened Calls" Height="800" Width="1200">

    <Window.DataContext>
        <local:CallForTreatmentViewModel x:Name="ViewModelInstance" />
    </Window.DataContext>

    <Window.Resources>
        <myConverters:StatusToColorConverter x:Key="StatusToColorConverter" />

        <Style x:Key="HeaderTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#2C3E50"/>
            <Setter Property="Margin" Value="5"/>
        </Style>

        <Style x:Key="ButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#3498DB"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#2980B9"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="SelectButtonStyle" TargetType="Button" BasedOn="{StaticResource ButtonStyle}">
            <Setter Property="Background" Value="#27AE60"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#229954"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="FilterComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Padding" Value="5"/>
            <Setter Property="MinWidth" Value="120"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="300"/>
        </Grid.RowDefinitions>


        <TextBlock Grid.Row="0" Text="Opened Calls"
                   FontSize="24" FontWeight="Bold"
                   HorizontalAlignment="Center"
                   Margin="10" Foreground="#2C3E50"/>

        <Border Grid.Row="1" Background="#ECF0F1" Padding="10" Margin="5">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <TextBlock Text="Filter By Call Type:" Style="{StaticResource HeaderTextStyle}" VerticalAlignment="Center"/>
                <ComboBox x:Name="CallTypeFilterComboBox" Style="{StaticResource FilterComboBoxStyle}"
                          ItemsSource="{Binding CallTypes}"
                          DisplayMemberPath="Text"
                          SelectedValuePath="Value"
                          SelectedValue="{Binding SelectedCallTypeFilter}" />

                <TextBlock Text="Sort By:" Style="{StaticResource HeaderTextStyle}" VerticalAlignment="Center" Margin="20,5,5,5"/>
                <ComboBox x:Name="SortFieldComboBox" Style="{StaticResource FilterComboBoxStyle}"
                          ItemsSource="{Binding SortOptions}"
                          DisplayMemberPath="Text"
                          SelectedValuePath="Value"
                          SelectedValue="{Binding SelectedSortOption}" />

                <Button x:Name="RefreshButton" Content="Refresh List" Style="{StaticResource ButtonStyle}"
                        Command="{Binding RefreshCommand}" Margin="20,5,5,5"/>

                <Button x:Name="UpdateAddressButton" Content="Update Adresses" Style="{StaticResource ButtonStyle}"
                        Command="{Binding UpdateVolunteerLocationCommand}"/>
            </StackPanel>
        </Border>

        <DataGrid x:Name="OpenCallsDataGrid" Grid.Row="2"
                  AutoGenerateColumns="False"
                  SelectionMode="Single"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  CanUserResizeRows="False"
                  GridLinesVisibility="Horizontal"
                  HeadersVisibility="Column"
                  ItemsSource="{Binding OpenCallsView}"
                  SelectedItem="{Binding SelectedCall}"
                  Margin="10">

            <DataGrid.Columns>
                <DataGridTextColumn Header="Call Number" Binding="{Binding Id}" Width="80" IsReadOnly="True"/>
                <DataGridTextColumn Header="Call Type" Binding="{Binding MyCallType}" Width="100" IsReadOnly="True"/>
                <DataGridTextColumn Header="Address" Binding="{Binding Address}" Width="200" IsReadOnly="True"/>
                <DataGridTextColumn Header="Opening Time" Binding="{Binding OpenTime, StringFormat='dd/MM/yyyy HH:mm'}" Width="120" IsReadOnly="True"/>
                <DataGridTextColumn Header="Max Finish Time" Binding="{Binding MaxFinishTime, StringFormat='dd/MM/yyyy HH:mm'}" Width="130" IsReadOnly="True"/>
                <DataGridTextColumn Header="Distance (KM)" Binding="{Binding DistanceFromVolunteerToCall, StringFormat=F2}" Width="80" IsReadOnly="True"/>

                <DataGridTemplateColumn Header="Action" Width="100">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Content=" Choose For Treatment"
                                    Style="{StaticResource SelectButtonStyle}"
                                    Command="{Binding DataContext.SelectCallCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                    CommandParameter="{Binding Id}"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <Grid Grid.Row="3">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" Background="#F8F9FA" BorderBrush="#DEE2E6" BorderThickness="1" Margin="10">
                <StackPanel Margin="10">
                    <TextBlock Text=" Selected Call Details " Style="{StaticResource HeaderTextStyle}" HorizontalAlignment="Center"/>
                    <Separator Margin="0,5"/>
                    <ScrollViewer MaxHeight="200" VerticalScrollBarVisibility="Auto">
                        <TextBlock x:Name="CallDescriptionTextBlock"
                                   TextWrapping="Wrap"
                                   Text="{Binding CallDetailsText}"
                                   FontSize="12"
                                   Margin="5"/>
                    </ScrollViewer>
                </StackPanel>
            </Border>

            <Border Grid.Column="1" Background="White" BorderBrush="#DEE2E6" BorderThickness="1" Margin="10">
                <Grid>
                    <m:Map x:Name="MyMap" CredentialsProvider="YOUR_BING_MAPS_KEY_HERE"
                           ZoomLevel="10" Center="{Binding VolunteerLocation}">
                        <m:Map.Children>
                            <m:Pushpin Location="{Binding VolunteerLocation}" ToolTip="My Location">
                                <m:Pushpin.Template>
                                    <ControlTemplate TargetType="m:Pushpin">
                                        <Grid>
                                            <Ellipse Width="20" Height="20" Fill="Blue" Opacity="0.7" />
                                            <TextBlock Text="V" Foreground="White" FontWeight="Bold"
                                                       HorizontalAlignment="Center" VerticalAlignment="Center" />
                                        </Grid>
                                    </ControlTemplate>
                                </m:Pushpin.Template>
                            </m:Pushpin>

                            <m:Pushpin Location="{Binding SelectedCall.Address.Location}" ToolTip="{Binding SelectedCall.Address}">
                                <m:Pushpin.Template>
                                    <ControlTemplate TargetType="m:Pushpin">
                                        <Grid>
                                            <Ellipse Width="20" Height="20" Fill="Red" Opacity="0.7" />
                                            <TextBlock Text="C" Foreground="White" FontWeight="Bold"
                                                       HorizontalAlignment="Center" VerticalAlignment="Center" />
                                        </Grid>
                                    </ControlTemplate>
                                </m:Pushpin.Template>
                            </m:Pushpin>

                            <m:MapPolyline Locations="{Binding Path=(local:MapHelper.Locations), RelativeSource={RelativeSource AncestorType=m:Map}}"
                                           Stroke="Blue" StrokeThickness="3" StrokeDashArray="2 1" />
                        </m:Map.Children>
                    </m:Map>
                    <TextBlock x:Name="MapPlaceholder" Text="Map - Volunteer Location and Call Location"
                               HorizontalAlignment="Center" VerticalAlignment="Center"
                               FontSize="14" Foreground="Gray" TextAlignment="Center"
                               Visibility="{Binding SelectedCall, Converter={StaticResource NullToVisibilityConverter}}"/>
                </Grid>
            </Border>
        </Grid>
        <TextBlock Grid.Row="3" Grid.ColumnSpan="2"
           Text="{Binding StatusMessage}"
           FontWeight="Bold" Foreground="DarkRed"
           VerticalAlignment="Center" HorizontalAlignment="Center" />
    </Grid>
</Window>-->
<Window x:Class="PL.Volunteer.CallForTreatment"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        WindowStartupLocation="CenterScreen"
        FlowDirection="RightToLeft"
        Title="Choose Opened Calls" Height="800" Width="1200">

    <Window.Resources>
        <Style x:Key="HeaderTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#2C3E50"/>
            <Setter Property="Margin" Value="5"/>
        </Style>

        <Style x:Key="ButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#3498DB"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#2980B9"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="SelectButtonStyle" TargetType="Button" BasedOn="{StaticResource ButtonStyle}">
            <Setter Property="Background" Value="#27AE60"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#229954"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="FilterComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Padding" Value="5"/>
            <Setter Property="MinWidth" Value="120"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="300"/>
        </Grid.RowDefinitions>

        
        <TextBlock Grid.Row="0" Text="Opened Calls" 
           FontSize="24" FontWeight="Bold" 
           HorizontalAlignment="Center" 
           Margin="10" Foreground="#2C3E50"/>

        <Border Grid.Row="1" Background="#ECF0F1" Padding="10" Margin="5">
            <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,10">
                <StackPanel Orientation="Vertical" Margin="10">
                    <TextBlock Text="Sort By:" FontSize="12" Margin="2"/>
                    <ComboBox Width="150" Height="28"
                  ItemsSource="{Binding SortFields}"
                  SelectedItem="{Binding SelectedSortField, Mode=TwoWay}">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" FontSize="12"/>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                </StackPanel>
                <StackPanel Orientation="Vertical" Margin="10">
                    <TextBlock Text="Filter by Call Type:" FontSize="12" Margin="2"/>
                    <ComboBox Width="150" Height="28"
                  ItemsSource="{Binding CallTypeList}"
                  SelectedItem="{Binding SelectedCallType, Mode=TwoWay}">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" FontSize="12"/>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                </StackPanel>
            </StackPanel>
        </Border>

        <DataGrid x:Name="OpenCallsDataGrid" Grid.Row="2" 
          AutoGenerateColumns="False" 
          SelectionMode="Single"
          CanUserAddRows="False"
          CanUserDeleteRows="False"
          CanUserResizeRows="False"
          GridLinesVisibility="Horizontal"
          HeadersVisibility="Column"
          ItemsSource="{Binding OpenCallList}"
          SelectionChanged="OpenCallsDataGrid_SelectionChanged"
          Margin="10">

            <DataGrid.Columns>
                <DataGridTextColumn Header="Call Number" Binding="{Binding Id}" Width="80" IsReadOnly="True"/>
                <DataGridTextColumn Header="Call Type" Binding="{Binding MyCallType}" Width="100" IsReadOnly="True"/>
                <DataGridTextColumn Header="Address" Binding="{Binding Address}" Width="200" IsReadOnly="True"/>
                <DataGridTextColumn Header="Opening Time" Binding="{Binding OpenTime, StringFormat='dd/MM/yyyy HH:mm'}" Width="120" IsReadOnly="True"/>
                <DataGridTextColumn Header="Max Finish Time" Binding="{Binding MaxFinishTime, StringFormat='dd/MM/yyyy HH:mm'}" Width="130" IsReadOnly="True"/>
                <DataGridTextColumn Header="Distance (KM)" Binding="{Binding distanceFromVolunteerToCall, StringFormat=F2}" Width="80" IsReadOnly="True"/>

                <DataGridTemplateColumn Header="Action" Width="100">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Content="Choose For Treatment" 
                            Style="{StaticResource SelectButtonStyle}"
                            Click="SelectCallButton_Click"
                            Tag="{Binding Id}"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <Grid Grid.Row="3">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" Background="#F8F9FA" BorderBrush="#DEE2E6" BorderThickness="1" Margin="10">
                <StackPanel Margin="10">
                    <TextBlock Text="Selected Call Details" Style="{StaticResource HeaderTextStyle}" HorizontalAlignment="Center"/>
                    <Separator Margin="0,5"/>
                    <ScrollViewer MaxHeight="220" VerticalScrollBarVisibility="Auto">
                        <TextBlock x:Name="CallDescriptionTextBlock" 
                                   TextWrapping="Wrap" 
                                   Text="Select a call from the list to see the details."
                                   FontSize="12"
                                   Margin="5"/>
                    </ScrollViewer>
                </StackPanel>
            </Border>
            <!-- Address Update Popup -->
            <Grid x:Name="UpdateAddressPopup" Visibility="Collapsed" Background="#80000000" Panel.ZIndex="100">
                <Border Background="White" Padding="20" CornerRadius="8" HorizontalAlignment="Center" VerticalAlignment="Center" Width="350">
                    <StackPanel>
                        <TextBlock Text="Enter new address:" FontSize="16" Margin="0,0,0,10"/>
                        <TextBox x:Name="AddressTextBox" FontSize="14" Margin="0,0,0,10"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <Button Content="OK" Width="80" Margin="5" Click="UpdateAddressOk_Click"/>
                            <Button Content="Cancel" Width="80" Margin="5" Click="UpdateAddressCancel_Click"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Grid>

        </Grid>
    </Grid>
</Window>